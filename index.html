<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HyperRocks</title>
  <style>
    :root {
      --bg: #0f0f1a;
      --card: #1a1a2e;
      --accent: #00d4ff;
      --text: #e0e0ff;
      --glow: 0 0 25px rgba(0, 212, 255, 0.6);
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Courier New', monospace;
      text-align: center;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      overflow-x: hidden;
    }
    .logo {
      width: 100px;
      height: 100px;
      margin: 20px auto;
      filter: drop-shadow(0 0 20px var(--accent));
      animation: float 6s infinite ease-in-out;
    }
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
    }
    h1 {
      font-size: 3em;
      color: var(--accent);
      text-shadow: var(--glow);
      margin: 10px 0 5px;
    }
    .tagline {
      font-size: 1.2em;
      color: #88aaff;
      margin-bottom: 30px;
    }
    .stats {
      display: flex;
      justify-content: space-around;
      width: 100%;
      max-width: 600px;
      margin-bottom: 20px;
      font-size: 1.1em;
    }
    .stat {
      background: var(--card);
      padding: 10px 20px;
      border-radius: 10px;
      border: 1px solid var(--accent);
    }
    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 25px;
      width: 100%;
      max-width: 1300px;
      padding: 0 20px;
    }
    .rock-card {
      background: var(--card);
      border: 1px solid var(--accent);
      border-radius: 18px;
      overflow: hidden;
      box-shadow: var(--glow);
      transition: all 0.4s ease;
      position: relative;
    }
    .rock-card:hover {
      transform: translateY(-12px) scale(1.02);
      box-shadow: 0 0 40px rgba(0, 212, 255, 0.9);
    }
    .rock-img {
      width: 100%;
      height: 300px;
      background: linear-gradient(135deg, #1a1a2e, #16213e);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }
    .rock-img img {
      width: 80%;
      height: 80%;
      object-fit: contain;
      filter: drop-shadow(0 0 10px #00d4ff);
    }
    .rock-img::before {
      content: '';
      position: absolute;
      top: 50%; left: 50%;
      width: 200%; height: 200%;
      background: radial-gradient(circle, rgba(0,212,255,0.3) 0%, transparent 70%);
      transform: translate(-50%, -50%);
      animation: pulseGlow 4s infinite;
    }
    @keyframes pulseGlow {
      0%, 100% { opacity: 0.3; transform: translate(-50%, -50%) scale(1); }
      50% { opacity: 0.6; transform: translate(-50%, -50%) scale(1.3); }
    }
    .rock-info {
      padding: 18px;
    }
    .rock-title {
      font-size: 1.4em;
      color: var(--accent);
      margin-bottom: 8px;
      font-weight: bold;
    }
    .rock-desc {
      font-size: 0.95em;
      color: #bbd;
      line-height: 1.5;
    }
    .traits {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin-top: 10px;
    }
    .trait {
      background: rgba(0,212,255,0.2);
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 0.8em;
      border: 1px solid var(--accent);
    }
    .loading {
      color: var(--accent);
      font-size: 1.3em;
      margin: 40px 0;
      animation: blink 1.5s infinite;
    }
    @keyframes blink {
      0%, 100% { opacity: 0.6; }
      50% { opacity: 1; }
    }
    footer {
      margin-top: 50px;
      font-size: 0.85em;
      color: #667;
    }
    .particle-bg {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none;
      z-index: -1;
    }
    .star {
      position: absolute;
      width: 2px; height: 2px;
      background: var(--accent);
      border-radius: 50%;
      opacity: 0;
      animation: twinkle 5s infinite;
    }
    @keyframes twinkle {
      0%, 100% { opacity: 0; }
      50% { opacity: 0.8; }
    }
    .contract-link {
      color: var(--accent);
      text-decoration: none;
      font-size: 0.9em;
      margin-top: 20px;
      display: inline-block;
    }
    .contract-link:hover {
      text-shadow: var(--glow);
    }
    .error {
      color: #ff6b6b;
      font-size: 1em;
      margin: 20px;
    }
  </style>
</head>
<body>

  <div class="particle-bg" id="stars"></div>

  <!-- Floating Rock Logo -->
  <div class="logo">Rock</div>

  <h1>HyperRocks Gallery</h1>
  <p class="tagline">All 1111 Rocks – Live from HyperEVM</p>

  <div class="stats" id="stats"></div>

  <div class="loading" id="loading">Loading 1111 Rocks...</div>
  <div class="error" id="error" style="display:none;"></div>

  <div class="gallery" id="gallery"></div>

  <a href="https://hyperevmscan.io/address/0x4CF79252EA6861c4338284e1A1F724d4e7ef667b" target="_blank" class="contract-link">View Contract on HyperEVMScan</a>

  <footer>HyperRocks • 1111 Unique • On-Chain Generated</footer>

  <script>
    // === CONFIG ===
    const CONTRACT_ADDRESS = "0x4CF79252EA6861c4338284e1A1F724d4e7ef667b";
    const RPC_URL = "https://rpc.hyperliquid.xyz/evm"; // MAINNET
    const MAX_SUPPLY = 1111;

    // Trait mappings (from contract)
    const TRAIT_MAPS = {
      background: ["stone", "ocean", "desert", "forest", "ice", "gold"],
      flower: ["none", "orange", "pinkbushbig", "purple", "blue", "pink", "red", "white", "yellow", "pinkbushmed", "orangebush", "orangesmall", "pinkbushsmall", "purplesmall", "bluesmall"],
      mineral: ["none", "coal", "lapis", "quartz", "amethyst", "gold", "ruby", "emerald", "diamond"],
      sparkle: ["none", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "16"]
    };

    // Full ABI
    const ABI = [
      "function name() view returns (string)",
      "function symbol() view returns (string)",
      "function totalSupply() view returns (uint256)",
      "function maxSupply() view returns (uint256)",
      "function tokenURI(uint256 tokenId) view returns (string)",
      "function getTraits(uint256 tokenId) view returns (uint256 background, uint256 rock, uint256 flower, uint256 mineral, uint256 sparkle)"
    ];

    // === DOM ===
    const loading = document.getElementById('loading');
    const errorEl = document.getElementById('error');
    const gallery = document.getElementById('gallery');
    const statsEl = document.getElementById('stats');
    const stars = document.getElementById('stars');

    // === PROVIDER ===
    const provider = new ethers.providers.JsonRpcProvider(RPC_URL);
    const contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, provider);

    // === HELPERS ===
    function showError(msg) {
      loading.style.display = 'none';
      errorEl.textContent = `Error: ${msg}`;
      errorEl.style.display = 'block';
    }

    function b64(svg) {
      return btoa(unescape(encodeURIComponent(svg)));
    }

    function formatTraits(traits) {
      return {
        background: TRAIT_MAPS.background[traits.background] || `BG-${traits.background}`,
        rock: `Rock-${traits.rock}`,
        flower: TRAIT_MAPS.flower[traits.flower] || `Flower-${traits.flower}`,
        mineral: TRAIT_MAPS.mineral[traits.mineral] || `Mineral-${traits.mineral}`,
        sparkle: TRAIT_MAPS.sparkle[traits.sparkle] || `Sparkle-${traits.sparkle}`
      };
    }

    // === FETCH ALL 1111 ===
    async function fetchAllRocks() {
      loading.textContent = 'Fetching total supply...';
      try {
        const [total, max] = await Promise.all([
          contract.totalSupply(),
          contract.maxSupply()
        ]);
        const minted = Number(total);
        const maxSupply = Number(max);
        statsEl.innerHTML = `
          <div class="stat">Name: HyperRocks</div>
          <div class="stat">Minted: ${minted} / ${maxSupply}</div>
          <div class="stat">Loading: 0 / ${MAX_SUPPLY}</div>
        `;

        if (minted === 0) {
          showError('No rocks minted yet.');
          return;
        }

        let loaded = 0;
        for (let id = 0; id < MAX_SUPPLY; id++) {
          const rock = await fetchRock(id);
          if (rock) {
            renderRock(rock);
            loaded++;
            statsEl.innerHTML = `
              <div class="stat">Name: HyperRocks</div>
              <div class="stat">Minted: ${minted} / ${maxSupply}</div>
              <div class="stat">Loaded: ${loaded} / ${MAX_SUPPLY}</div>
            `;
          }
        }

        loading.style.display = 'none';
      } catch (err) {
        showError('Failed: ' + err.message);
      }
    }

    async function fetchRock(tokenId) {
      try {
        const uri = await contract.tokenURI(tokenId);
        const res = await fetch(uri);
        if (!res.ok) return null;
        const meta = await res.json();
        const img = meta.image;
        if (!img || !img.startsWith('data:image/svg+xml;base64,')) return null;
        const rawSVG = atob(img.split(',')[1]);

        const traits = await contract.getTraits(tokenId);
        const fmt = formatTraits(traits);

        return { id: tokenId + 1, svg: rawSVG, traits: fmt };
      } catch (err) {
        return null;
      }
    }

    function renderRock(rock) {
      const card = document.createElement('div');
      card.className = 'rock-card';
      const tags = Object.entries(rock.traits).map(([k,v])=>`<span class="trait">${k}: ${v}</span>`).join('');
      card.innerHTML = `
        <div class="rock-img">
          <img src="data:image/svg+xml;base64,${b64(rock.svg)}" alt="Rock ${rock.id}">
        </div>
        <div class="rock-info">
          <div class="rock-title">Rock #${rock.id}</div>
          <div class="rock-desc">On-chain SVG from HyperEVM</div>
          <div class="traits">${tags}</div>
        </div>
      `;
      gallery.appendChild(card);
    }

    // === PARTICLES ===
    function createStars() {
      for (let i = 0; i < 100; i++) {
        const s = document.createElement('div');
        s.className = 'star';
        s.style.left = Math.random()*100 + '%';
        s.style.top = Math.random()*100 + '%';
        s.style.animationDelay = Math.random()*5 + 's';
        stars.appendChild(s);
      }
    }

    // === INIT ===
    createStars();
    fetchAllRocks();
  </script>
  <script src="https://cdn.ethers.io/lib/ethers-5.7.umd.min.js"></script>
</body>
</html>
